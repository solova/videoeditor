//Исходники доступны в открытом репозитории на github - 
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s={}.hasOwnProperty,t=function(a,b){function c(){this.constructor=a}for(var d in b)s.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};h=function(a){function b(){return k=b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.defaults={offset:0,duration:5e3,resizable:!1,visible:!1},b.prototype.initialize=function(a){var b,c=this;return null!=a?(b=new FileReader,b.onload=function(b){return c.set("name",a.name),c.set("size",a.size),c.set("type",a.type),c.set("data",b.target.result),"audio/mp3"===a.type?c.set("mp3",new Audio(b.target.result)):void 0},b.readAsDataURL(a)):void 0},b.prototype.offset=function(a){return null!=a?this.set("offset",1e3*a):this.get("offset")/1e3},b.prototype.duration=function(a){return null!=a?this.set("duration",1e3*a):this.get("duration")/1e3},b}(Backbone.Model),i=function(a){function b(){return l=b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.model=h,b}(Backbone.Collection),f=function(a){function b(){return m=b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.defaults={volume:.5,position:0,len:10,fullscreen:!1,played:!1},b.prototype.initialize=function(){var a,b=this;return a=new i,a.on("change",function(){var c;return c=0,a.forEach(function(a){var b;return b=a.offset()+a.duration(),b>c?c=b:void 0}),b.get("len")<c?b.set("len",c):void 0}),this.set("tracks",a),this.next()},b.prototype.add=function(a){var b;return b=this.get("tracks"),b.add(a),a},b.prototype.remove=function(a){var b;return b=this.get("tracks"),b.remove(a),a},b.prototype.next=function(){var a,b,c=this;return this.get("played")===!0?(0!==this.lastFrame&&(b=+new Date-this.lastFrame,a=this.get("position"),a+=b/1e3,a>this.get("len")&&(a=0),this.set("position",a+b/1e3)),this.lastFrame=+new Date):this.lastFrame=0,webkitRequestAnimationFrame(function(){return c.next()})},b.prototype.play=function(){return this.set("played",!0)},b.prototype.pause=function(){return this.set("played",!1)},b.prototype.volume=function(a){return null!=a?this.set("volume",a):this.get("volume")},b.prototype.position=function(a){return null!=a?this.set("position",a):this.get("position")},b.prototype.tracks=function(){return this.get("tracks").models},b}(Backbone.Model),e=new f,a=function(a){function f(){return n=f.__super__.constructor.apply(this,arguments)}return t(f,a),f.prototype.render=function(){var a,f,h,i;for(a=new b({model:e}),a.render(),f=new c({model:e}),f.render(),h=new d({model:e}),h.render(),i=new g({model:e}),i.render();this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this.el.appendChild(a.el),this.el.appendChild(f.el),this.el.appendChild(h.el),this.el.appendChild(i.el)},f}(Backbone.View),b=function(a){function b(){return o=b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.tagName="div",b.prototype.className="pure-menu pure-menu-open pure-menu-horizontal",b.prototype.events={"change .upload-media":"upload","click .playpause":"playpause","click .fullscreen":"fullscreen","click .save":"save","click .load":"load","click .volumeup":"volumeup","click .volumedown":"volumedown"},b.prototype.initialize=function(){return this.items=[{className:"playpause",caption:"Воспроизведение/Пауза"},{className:"fullscreen disabled",caption:"Полноэкранный режим"},{className:"volumeup",caption:"Громче"},{className:"volumedown",caption:"Тише"},{className:"save",caption:"Сохранить"},{className:"load",caption:"Загрузить"}]},b.prototype.upload=function(a){var b,c,d,f,g,i,j,k,l,m;for(b=a.target,i=b.files,c=i.length,m=[],k=0,l=i.length;l>k;k++)f=i[k],g=f.name,d=g.split(".").pop(),"json"!==d?(j=new h(f),m.push(e.add(j))):m.push(this.loadJSON(f));return m},b.prototype.playpause=function(a){var b;return a.preventDefault(),b=this.model.get("played"),this.model.set("played",!b)},b.prototype.fullscreen=function(a){var b;return a.preventDefault(),b=this.model.get("fullscreen"),this.model.set("fullscreen",!b),!1},b.prototype.save=function(){var a,b,c,d;return b=JSON.stringify(this.model.get("tracks").toJSON()),a=new Blob([b],{type:"application/json"}),d=URL.createObjectURL(a),c=document.querySelector(".save"),c.download="project.json",c.href=d},b.prototype.load=function(a){return a.preventDefault(),alert("Загрузите json-файл проекта в первом пункте меню (как медиафрагмент)")},b.prototype.loadJSON=function(a){var b,c=this;return b=new FileReader,b.onload=function(a){var b;return b=JSON.parse(a.target.result),c.model.get("tracks").reset(b)},b.readAsText(a)},b.prototype.volumeup=function(a){var b;return a.preventDefault(),b=this.model.get("volume"),b=Math.min(b+.1,1),this.model.set("volume",b)},b.prototype.volumedown=function(a){var b;return a.preventDefault(),b=this.model.get("volume"),b=Math.max(b-.1,0),this.model.set("volume",b)},b.prototype.template=function(a){return'<li><a href="#" class="'+a.className+'">'+a.caption+"</a></li>"},b.prototype.render=function(){var a,b,c;return a=document.createElement("B"),a.className="pure-menu-heading",a.innerHTML="Загрузка файлов:",b=document.createElement("ul"),b.innerHTML=this.items.map(this.template).join(""),c=document.createElement("INPUT"),c.setAttribute("type","file"),c.setAttribute("multiple","multiple"),c.setAttribute("accept","image/*|audio/*"),c.className="upload-media",this.el.appendChild(a),this.el.appendChild(c),this.el.appendChild(b),this},b}(Backbone.View),c=function(a){function b(){return p=b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.tagName="div",b.prototype.className="video",b.prototype.initialize=function(){var a;return this.status=document.createElement("div"),this.status.className="status",this.el.appendChild(this.status),this.imageContainer=document.createElement("div"),this.imageContainer.className="imageContainer",this.el.appendChild(this.imageContainer),a=Backbone.Collection.extend({model:h}),this.active=new a,this.active.on("add",this.addMedia,this),this.active.on("remove",this.removeMedia,this),this.model.on("change:played change:position change:volume",this.render,this),this.model.on("change:volume",this.changeVolume,this)},b.prototype.addMedia=function(a){var b,c;return("image/jpeg"===(c=a.get("type"))||"image/png"===c)&&(b=a.get("data"),this.imageContainer.style.backgroundImage="url("+b+")"),"audio/mp3"===a.get("type")?(a.get("mp3").volume=this.model.get("volume"),a.get("mp3").currentTime=this.model.get("position")-a.get("offset"),a.get("mp3").play()):void 0},b.prototype.removeMedia=function(a){var b,c;return"image/jpeg"===(c=a.get("type"))||"image/png"===c?(b="",this.active.forEach(function(a){var c;return"image/jpeg"===(c=a.get("type"))||"image/png"===c?b=a.get("data"):void 0}),this.imageContainer.style.backgroundImage=b?"url("+b+")":"none"):a.get("mp3").pause()},b.prototype.changeVolume=function(){var a,b;return b=this.model.get("volume"),a=this.model.get("tracks"),a.forEach(function(a){return"audio/mp3"===a.get("type")?a.get("mp3").volume=b:void 0})},b.prototype.render=function(){var a,b,c,d,e,f=this;return e=Math.floor(100*this.model.get("volume")),b=this.model.get("position"),a=this.model.get("played"),c=a?"Играется":"На паузе",this.status.innerHTML=""+c+" Громкость: "+e,d=this.model.get("tracks"),d.forEach(function(a){if(b>=a.offset()&&b<a.offset()+a.duration()){if(a.get("visible")===!1)return a.set("visible",!0),f.active.add(a)}else if(a.get("visible")===!0)return a.set("visible",!1),f.active.remove(a)}),this},b}(Backbone.View),d=function(a){function b(){return q=b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.tagName="div",b.prototype.className="progress",b.prototype.events={click:"goto"},b.prototype.initialize=function(){return this.indicator=document.createElement("b"),this.indicator.className="indicator",this.el.appendChild(this.indicator),this.model.on("change:position",this.render,this)},b.prototype.goto=function(a){return this.model.set("position",a.clientX/100)},b.prototype.render=function(){return this.indicator.style.width=100*this.model.get("position")+"px"},b}(Backbone.View),g=function(a){function b(){return r=b.__super__.constructor.apply(this,arguments)}return t(b,a),b.prototype.tagName="ul",b.prototype.className="timeline",b.prototype.events={"mousedown .element span":"dragstart",mouseup:"dragend",mousemove:"drag"},b.prototype.initialize=function(){return this.collection=this.model.get("tracks"),this.collection.on("add remove reset",this.render,this)},b.prototype.dragstart=function(a){return this.dragEl=a.delegateTarget,"b"===a.target.tagName.toLowerCase()?this.dragEl.classList.add("draggable"):this.dragEl.classList.add("resizable"),this.dragX=a.clientX,this.dragW=parseInt(this.dragEl.firstChild.style.width,10)},b.prototype.drag=function(a){var b,c;return null!=this.dragEl&&(this.dragEl.classList.contains("draggable")&&(b=0|this.dragEl.dataset.offset,b+=a.clientX-this.dragX,this.dragEl.style.left=""+b+"px"),this.dragEl.classList.contains("resizable"))?(b=a.clientX-this.dragX,c=this.dragW+b,this.dragEl.firstChild.style.width=""+c+"px"):void 0},b.prototype.dragend=function(a){var b,c,d;return null!=this.dragEl?(this.dragEl.classList.contains("draggable")&&(this.dragEl.classList.remove("draggable"),c=0|this.dragEl.dataset.offset,c+=a.clientX-this.dragX,this.dragEl.style.left=""+c+"px",this.dragEl.dataset.offset=c,b=this.dragEl.dataset.cid,this.collection.get(b).set("offset",10*c)),this.dragEl.classList.contains("resizable")&&(this.dragEl.classList.remove("resizable"),c=a.clientX-this.dragX,d=this.dragW+c,b=this.dragEl.dataset.cid,this.collection.get(b).set("duration",10*d)),this.dragEl=null):void 0},b.prototype.template=function(a){var b,c;return c=a.get("duration")/10,b=a.get("offset")/10,'<li class="element"><span data-cid="'+a.cid+'" style="left: '+b+'px" data-offset="'+b+'"><b style="width:'+c+'px">'+a.get("name")+" ("+a.get("type")+")</b><span></li>"},b.prototype.render=function(){return this.el.innerHTML=this.collection.map(this.template,this).join(""),this},b}(Backbone.View),j=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)},window.onload=function(){var b;return b=new a({el:document.body}),b.render()}}).call(this);